@require '../../vars'

$zIndexTextarea = 2

// overflow:auto; display:flex; flex-direction:column-reverse;

.is-firefox .z-conversation > .messages > .messages-inner
  min-height: 0 // for firefox scrolling to work

.z-conversation
  display: flex
  flex1()
  flex-direction: column
  width: 100%
  position: relative

  > .loading
    position: absolute
    z-index: 999
    top: 0
    left: 0
    right: 0
    height: 30px

  // &.has-bottom-bar
  //   > .messages
  //     padding-top: 30px + 64px
  //
  //   > .loading
  //     top: 64px

  > .messages
    transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1)
    flex1()
    overflow-y: auto
    overflow-x: hidden
    -webkit-overflow-scrolling: touch

    // https://stackoverflow.com/questions/18614301/keep-overflow-div-scrolled-to-bottom-unless-user-scrolls-up?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa
    // reverse scrolling so we always stay at the bottom
    display: flex
    flex-direction: column-reverse

    // use gpu
    // transform: translateZ(0)
    // https://stackoverflow.com/questions/39261456/reducing-scroll-jank-when-using-overflow-y-scroll/39368219
    will-change: transform
    // margin-bottom: 64px
    width: 100%
    min-width: 0 // fix
    padding: 8px 0
    box-sizing: border-box
    padding-top: 30px // for loading more indicator
    margin-bottom: 64px // for bottom input bar
    // padding-bottom: 90px

    > .messages-inner
      > .message-batch
        opacity: 0
        // chrome has painting glitch without this. when scrolling, some
        // messages will flicker, or get clipped out
        will-change: transform

        &.is-loaded
          opacity: 1

        // > .divider
        //   width: 100%
        //   height: 1px
        //   background: getColor('$bgText12')
        //   margin: 0

  > .bottom
    padding: 0 8px 8px 8px
    position: absolute
    border-top: 1px solid getColor('$bgText12')
    bottom: -1px // fix text showing behind for bottom 1px
    left: 0
    right: 0
    background: getColor('$bg')

    > .jump-new
      position: absolute
      left: 0
      top: -24px
      background: getColor('$primaryMain')
      color: getColor('$primaryMainText')
      height: 24px
      width: 100%
      padding: 4px 16px
      box-sizing: border-box
      cursor: pointer

    &.is-gate
      shadow-upper-1()
      background: getColor('$tertiary0')
      padding: 16px

      > .text
        font-body1()
        text-align: center
        margin-bottom: 16px

  &.use-iscroll
    > .messages
      overflow-y: hidden
      -webkit-overflow-scrolling: auto
      // flex-direction: column

  @media (min-width: $breakPointMedium)
    > .textarea-container
      background: getColor('$bg')

    > .bottom
      bottom: 0px

      // > .g-grid
      //   margin-bottom: 16px
